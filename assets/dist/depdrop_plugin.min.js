function depDrop(a,e,c){this.depField=document.getElementById(a);this.depends=e;this.url=c;var d=this;var b=new Event("change");this.init=function(){this.depField.setAttribute("disabled",true);this.initEvents()};this.initEvents=function(){for(i=0;i<this.depends.length;i++){$("#"+this.depends[i]).on("change",function(f){d.getOptions(f.target)})}this.getOptions()};this.getOptions=function(f){if(this.beforeSend()&&this.checkReady()){$.ajax({url:d.url,type:"post",data:this.populateData(),success:function(g){d.removeOldOptions();$.each(g.output,function(h,j){$(d.depField).find("option").end().append('<option value="'+j.id+'">'+j.name+"</option>").val(g.selected).prop("disabled",false)});if(g.selected){$(d.depField).val(g.selected).trigger("change")}}})}};this.beforeSend=function(){var f=false;$.each(this.depends,function(h,g){var j=document.getElementById(g);if(j===null||j.value===""){f=true}});if(f&&this.depField&&!this.depField.getAttribute("disabled")){$(d.depField).val(response.selected).prop("disabled").trigger("change");console.log("cleared!")}return !f};this.removeOldOptions=function(){$(d.depField).find("option").filter(function(){return $(this).attr("value")!==""}).remove()};this.populateData=function(){var g={},f={};$.each(this.depends,function(k,m){var l=document.getElementById(m);if(l!==null){f[l.id]=l.value;if(l.name.match(/\[\w+\]/i)){var h=l.name.replace(/^.*?\[(.*?)\]$/i,"$1"),j=l.name.replace(/^(.*?)\[.*?\]$/i,"$1");if(typeof g[j]==="undefined"){g[j]={}}g[j][h]=l.value}}});g.depdrop_all_params=f;return g};this.checkReady=function(){var f=true;$.each(this.depends,function(h,g){var j=document.getElementById(g);if(j===null||j.value===""){f=false}});return f}};